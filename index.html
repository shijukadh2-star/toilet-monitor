<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amos å«ç”Ÿé—´çŠ¶æ€</title>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f2f2f7; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .card { background: white; width: 85%; max-width: 350px; padding: 40px 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); text-align: center; position: relative;}
        
        .status-circle { width: 140px; height: 140px; border-radius: 50%; margin: 0 auto 30px; display: flex; align-items: center; justify-content: center; font-size: 60px; transition: all 0.3s; background-color: #ddd; }
        
        .free { background-color: #34C759; box-shadow: 0 10px 20px rgba(52, 199, 89, 0.3); color: white; animation: pulse-green 2s infinite; }
        .busy { background-color: #FF3B30; box-shadow: 0 10px 20px rgba(255, 59, 48, 0.3); color: white; animation: pulse-red 2s infinite; }
        
        h1 { margin: 0; font-size: 28px; color: #1c1c1e; font-weight: 700; }
        p { margin-top: 10px; color: #8e8e93; font-size: 14px; }
        
        /* å‘¼å¸ç¯åŠ¨ç”» */
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(52, 199, 89, 0); } 100% { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0); } }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(255, 59, 48, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0); } }

        /* å³ä¸Šè§’å¿ƒè·³ç‚¹ */
        .live-indicator { position: absolute; top: 20px; right: 20px; width: 8px; height: 8px; background-color: #ccc; border-radius: 50%; }
        .blinking { background-color: #34C759; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        .brand { position: absolute; bottom: 30px; color: #c7c7cc; font-size: 12px; font-weight: 500; letter-spacing: 1px; }
        #debug { font-size: 10px; color: #ccc; margin-top: 20px; height: 15px;}
    </style>
</head>
<body>

    <div class="card">
        <div id="liveDot" class="live-indicator"></div>

        <div id="circle" class="status-circle">?</div>
        <h1 id="statusText">è¿æ¥ä¸­...</h1>
        <p id="timeText">Amos Internal System</p>
        <div id="debug"></div>
    </div>

    <div class="brand">AMOS SWEETS</div>

    <script>
        // âœ… ä½ çš„ UID (å·²å¡«å¥½)
        const uid = "21f86b4c0b9947c99462f1c86809f86f";
        const topic = "toilet001";

        async function refresh() {
            // è®©å³ä¸Šè§’çš„å°ç‚¹é—ªä¸€ä¸‹ï¼Œè¡¨ç¤ºâ€œæˆ‘åœ¨è¯·æ±‚äº†â€
            const dot = document.getElementById('liveDot');
            dot.classList.add('blinking');

            try {
                // ğŸ”¥ æ ¸å¿ƒä¿®æ”¹ï¼šç”Ÿæˆéšæœºæ—¶é—´æˆ³ï¼Œå½»åº•ç¦æ­¢ç¼“å­˜
                const timestamp = new Date().getTime();

                // ğŸ”¥ ç›´è¿åœ°å€ï¼šä¸èµ°ä»£ç†ï¼Œç›´æ¥è®¿é—®å·´æ³•äº‘
                // æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯ https://api.bemfa.com (ä½ éªŒè¯è¿‡èƒ½é€šçš„é‚£ä¸ª)
                const targetUrl = `https://api.bemfa.com/api/device/v1/data/1/get/?uid=${uid}&topic=${topic}&num=1&t=${timestamp}`;
                
                // è®¾ç½® fetch æ¨¡å¼ä¸º corsï¼Œè™½ç„¶å·´æ³•äº‘æ”¯æŒï¼Œä½†æ˜¾å¼å£°æ˜æ›´å¥½
                const res = await fetch(targetUrl, { method: 'GET', mode: 'cors' });
                
                if (!res.ok) throw new Error("ç½‘ç»œæ³¢åŠ¨");

                const json = await res.json();
                
                // è§£ææ•°æ®
                if (json.msg) {
                    updateUI(json.msg.trim());
                    document.getElementById('debug').innerText = ""; 
                }
            } catch (e) {
                console.error(e);
                // åªæœ‰è¿ç»­å¤±è´¥æ‰æ˜¾ç¤ºï¼Œé¿å…é—ªçƒ
                // document.getElementById('statusText').innerText = "åŒæ­¥æ…¢";
            } finally {
                // è¯·æ±‚ç»“æŸï¼Œå°ç‚¹åœæ­¢é—ªçƒ(å¯é€‰ï¼Œè¿™é‡Œè®©å®ƒä¸€ç›´é—ªæ›´æœ‰å®‰å…¨æ„Ÿ)
                // dot.classList.remove('blinking'); 
            }
        }

        function updateUI(msg) {
            const circle = document.getElementById('circle');
            const text = document.getElementById('statusText');
            const time = document.getElementById('timeText');
            const now = new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit', second:'2-digit'});

            if (msg === "on") {
                circle.className = "status-circle busy";
                circle.innerHTML = "âœ‹"; 
                text.innerText = "ä½¿ç”¨ä¸­";
                text.style.color = "#FF3B30";
            } else if (msg === "off") {
                circle.className = "status-circle free";
                circle.innerHTML = "âœ…"; 
                text.innerText = "ç©ºé—²";
                text.style.color = "#34C759";
            }
            time.innerText = "æ›´æ–°äº: " + now;
        }

        // âš¡ï¸ æé€Ÿï¼šæ”¹ä¸º 2 ç§’åˆ·æ–°ä¸€æ¬¡
        setInterval(refresh, 2000);
        refresh();
    </script>
</body>
</html>
