<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amos Âç´ÁîüÈó¥Áä∂ÊÄÅ</title>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f2f2f7; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .card { background: white; width: 85%; max-width: 350px; padding: 40px 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); text-align: center; }
        .status-circle { width: 140px; height: 140px; border-radius: 50%; margin: 0 auto 30px; display: flex; align-items: center; justify-content: center; font-size: 60px; transition: all 0.3s; background-color: #ddd; }
        .free { background-color: #34C759; box-shadow: 0 10px 20px rgba(52, 199, 89, 0.3); color: white; }
        .busy { background-color: #FF3B30; box-shadow: 0 10px 20px rgba(255, 59, 48, 0.3); color: white; }
        h1 { margin: 0; font-size: 28px; color: #1c1c1e; font-weight: 700; }
        p { margin-top: 10px; color: #8e8e93; font-size: 14px; }
        .brand { position: absolute; bottom: 30px; color: #c7c7cc; font-size: 12px; font-weight: 500; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="card">
        <div id="circle" class="status-circle">?</div>
        <h1 id="statusText">Ê≠£Âú®ÂêåÊ≠•...</h1>
        <p id="timeText">Amos Internal System</p>
    </div>

    <div class="brand">AMOS SWEETS</div>

    <script>
    // üî¥üî¥üî¥ ËØ∑Â°´ÂÖ•‰Ω†ÁöÑ UID üî¥üî¥üî¥
    const uid = "21f86b4c0b9947c99462f1c86809f86f";
    const topic = "toilet001";
    const type = "3";  // üî• Êñ∞Â¢ûÔºöÂçèËÆÆÁ±ªÂûãÔºå3=TCPÔºàÂåπÈÖç‰Ω†ÁöÑËÆæÂ§áÊé®ÈÄÅÊñπÂºèÔºâÔºåÂ¶ÇÁî®MQTTÂàôÊîπ1
    // üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥
    async function refresh() {
        try {
            // üî• ‰øÆÊîπÔºö‰ΩøÁî®Êñ∞ÁâàAPIÁ´ØÁÇπÂíåÊü•ËØ¢Â≠óÁ¨¶‰∏≤Ê†ºÂºè
            const targetUrl = `https://apis.bemfa.com/va/getmsg?uid=${uid}&topic=${topic}&type=${type}&num=1`;
           
            // ÁªßÁª≠Áî®allorigins‰ª£ÁêÜÁªïËøáCORSÔºàÂ¶ÇÊûú‰∏çÈúÄË¶ÅÂèØÁßªÈô§Ôºâ
            const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`;
            const res = await fetch(proxyUrl);
            const jsonWrapper = await res.json();
           
            // allorigins ÊääÊï∞ÊçÆÊîæcontentsÈáåÔºåËß£ÊûêÊàêJSON
            const realData = JSON.parse(jsonWrapper.contents);
           
            // üî• ‰øÆÊîπÔºöÊñ∞ÁâàÂìçÂ∫îÊ†ºÂºèÔºåÊ£ÄÊü•ÊòØÂê¶ÊúâÊï∞ÊçÆ
            if (realData.code === 0 && realData.data && realData.data.length > 0) {
                let msg = realData.data[0].msg.trim();  // Êñ∞ÁâàdataÊòØÊï∞ÁªÑÔºåmsgÂú®ÂÖ∂‰∏≠
                updateUI(msg);
            } else {
                updateUI("nodata");
            }
        } catch (e) {
            console.error(e);
            document.getElementById('statusText').innerText = "ÁΩëÁªúÂèóÈôê";
        }
    }
    function updateUI(msg) {
        const circle = document.getElementById('circle');
        const text = document.getElementById('statusText');
        const time = document.getElementById('timeText');
        const now = new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
        if (msg === "on") {
            circle.className = "status-circle busy";
            circle.innerHTML = "‚úã";
            text.innerText = "‰ΩøÁî®‰∏≠";
            text.style.color = "#FF3B30";
        } else if (msg === "off") {
            circle.className = "status-circle free";
            circle.innerHTML = "‚úÖ";
            text.innerText = "Á©∫Èó≤";
            text.style.color = "#34C759";
        } else {
            circle.className = "status-circle";
            circle.innerHTML = "?";
            text.innerText = "Êó†Êï∞ÊçÆ";
            text.style.color = "#8e8e93";
        }
        time.innerText = "Êõ¥Êñ∞‰∫é: " + now;
    }
    setInterval(refresh, 3000);
    refresh();
 </script>
</body>
</html>

